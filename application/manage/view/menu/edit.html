

<div class="row">
    <div class="col-xs-12">
        <div class="box box-info">
            <div class="box-header with-border">
                <h4 class="box-title">菜单信息</h4>
            </div>
            <form action="<%{:url('menu/edit')}%>" class="form-horizontal" id="menuEdit">
                <div class="box-body">
                    <div class="menu_deal_intro">
                        <h3>待选字段列表填写说明：</h3>
                        <ul>
                            <li>1、`字段`填写带别名的数据表字段，程序中会使用到，例如：order.sn、order_detail.buy_num</li>
                            <li>2、`名称`填写字段对应的中文名称，前端显示上会用到，例如：订单号、购买数量</li>
                            <li>3、`可排序`选项指定该字段在列表中是否可以作为排序的字段</li>
                            <li>4、`必选`选项指定该字段在列表中是必须显示的</li>
                            <li>5、删除按钮可删除该字段</li>
                            <li>6、移动按钮可调整字段顺序，从上往下依次对应自左到右</li>
                        </ul>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">一级菜单：</label>
                        <div class="col-sm-5">
                            <select name="Menu[level1]" id="level1" class="form-control select2">
                                <option value="">--新建一级菜单--</option>
                                <%{volist name="list" id="item"}%>
                                    <%{if condition="$item.level EQ 1"}%>
                                        <option value="<%{$item.id}%>"<%{if condition="$menu_edit.level EQ 1 && $menu_edit.id EQ $item.id && $menu_edit.level NEQ 1"}%> selected="selected"<%{/if}%>><%{$item.name}%></option>
                                    <%{/if}%>
                                <%{/volist}%>
                            </select>
                        </div>
                    </div>
                    <input type="hidden" name="Menu[id]" value="<%{$menu_edit.id}%>">
                    <div class="form-group" id="level2_container">
                        <label class="col-sm-2 control-label">二级菜单：</label>
                        <div class="col-sm-5">
                            <select name="Menu[level2]" id="level2" class="form-control select2">
                                <option value="">--新建二级菜单--</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">菜单名称：</label>
                        <div class="col-sm-5"><input type="text" id="name" class="form-control" name="Menu[name]" placeholder="菜单名称，将显示在左侧导航栏，例如：工作台" value="<%{$menu_edit.name}%>">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-sm-2 control-label">菜单标签：</label>
                        <div class="col-sm-5">
                            <input type="text" id="tag" class="form-control" name="Menu[tag]" placeholder="菜单标签，不得超过50字符，全局唯一，例如：MenuAction" value="<%{$menu_edit.tag}%>">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">导航链接：</label>
                        <div class="col-sm-5">
                            <input type="text" id="url" class="form-control" name="Menu[url]" placeholder="菜单点击后打开的网址，格式如下：menu/list" value="<%{$menu_edit.url}%>">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">图标class类：</label>
                        <div class="col-sm-5">
                            <input type="text" id="icon" class="form-control" name="Menu[icon]" placeholder="fontawesome、glyphicon或ionicons图标的class，例如：fa fa-cog" value="<%{$menu_edit.icon}%>">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">菜单排序：</label>
                        <div class="col-sm-5">
                            <input type="number" id="sort" class="form-control" name="Menu[sort]" placeholder="该级别的排序，大于0的整数，数字越小越靠前" value="<%{$menu_edit.sort}%>">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">是否必选：</label>
                        <div class="col-sm-5">
                            <div class="js-switch-container">
                                <input type="checkbox" id="is_required" name="Menu[is_required]" data-on-text="是" data-off-text="否"<%{if condition="$menu_edit.is_required EQ 1"}%> checked="checked"<%{/if}%>>
                                <div class="js-switch-context">是否为必选的公用菜单</div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">是否badge：</label>
                        <div class="col-sm-5">
                            <div class="js-switch-container">
                                <input type="checkbox" id="is_badge" name="Menu[is_badge]" data-on-text="是" data-off-text="否"<%{if condition="$menu_edit.is_badge EQ 1"}%> checked="checked"<%{/if}%>>
                                <div class="js-switch-context">是否需要在菜单导航上显示badge小红点统计</div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">是否系统菜单：</label>
                        <div class="col-sm-5">
                            <div class="js-switch-container">
                                <input type="checkbox" id="is_system" name="Menu[is_system]" title="是" data-on-text="是" data-off-text="否"<%{if condition="$menu_edit.is_system EQ 1"}%> checked="checked"<%{/if}%>>
                                <div class="js-switch-context">选是菜单列表不显示删除按钮即不可删除</div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">是否数据权限控制：</label>
                        <div class="col-sm-5">
                            <div class="js-switch-container">
                                <input type="checkbox" id="is_permissions" name="Menu[is_permissions]" title="是" data-on-text="是" data-off-text="否" "<%{if condition="$menu_edit.is_permissions EQ 1"}%> checked="checked"<%{/if}%>>
                                <div class="js-switch-context">是否在角色中限定查看数据的范围：全部、部门和个人、仅个人、游客</div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">备注信息：</label>
                        <div class="col-sm-5">
                            <textarea id="remark" rows=3 class="form-control" name="Menu[remark]" placeholder="菜单备注信息，便于管理员识别，可选"><%{$menu_edit.remark}%></textarea>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">是否控制字段显示：</label>
                        <div class="col-sm-5">
                            <div class="js-switch-container">
                                <input type="checkbox" id="is_column" name="Menu[is_column]" data-on-text="是" data-off-text="否" "<%{if condition="$menu_edit.is_column EQ 1"}%> checked="checked"<%{/if}%>>
                                <div class="js-switch-context">是否需要定制不同角色菜单页面里的列表中显示不同字段</div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group" id="columns_container">
                        <label class="col-sm-2 control-label">待选字段列表：</label>
                        <div class="col-sm-8 columns_item">
                            <ul id="columns_item_container">
                                <%{if condition="isset($menu_edit.all_columns)"}%>
                                <%{volist name="menu_edit.all_columns" id="columns"}%>
                                    <li class="form-group columns_group">
                                        <div class="columns_manage">
                                            <i class="fa fa-trash"></i>
                                            <i class="fa fa-arrows-alt"></i>
                                        </div>
                                        <div class="col-xs-4">
                                            <div class="input-group">
                                                <div class="input-group-addon">字段</div>
                                                <input type="text" class="form-control columns" name="Columns[columns][]" placeholder="order.order_sn" value="<%{$columns.columns}%>">
                                            </div>
                                        </div>
                                        <div class="col-xs-4">
                                            <div class="input-group">
                                                <div class="input-group-addon">名称</div>
                                                <input type="text" class="form-control name" name="Columns[name][]" placeholder="字段名称" value="<%{$columns.name}%>">
                                            </div>
                                        </div>
                                        <div class="col-xs-2">
                                            <div class="checkbox">
                                                <label>
                                                    <input type="checkbox" class="sorted" name="Columns[sorted][]"<%{if condition="!empty($columns.sorted)"}%> checked="checked"<%{/if}%>> 可排序
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-xs-2">
                                            <div class="checkbox">
                                                <label>
                                                    <input type="checkbox" class="default" name="Columns[default][]"<%{if condition="!empty($columns.default)"}%> checked="checked"<%{/if}%>> 必选
                                                </label>
                                            </div>
                                        </div>
                                    </li>
                                <%{/volist}%>
                                <%{/if}%>
                            </ul>
                            <div class="form-group columns_group_btn">
                                <div class="col-xs-6">
                                    <button type="button" class="btn btn-block btn-default" id="insert_five_columns">
                                        <i class="fa fa-plus"></i> 点此新增5个字段
                                    </button>
                                </div>
                                <div class="col-xs-6">
                                    <button type="button" class="btn btn-block btn-default"  id="insert_ten_columns">
                                        <i class="fa fa-plus"></i> 点此新增10个字段
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="box-footer">
                    <div class="row">
                        <div class="col-sm-offset-2 col-sm-5"><button type="submit" class="btn btn-success pull-right btn-submit">提交</button></div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<script src="__PUBLIC__/plugin/sortable/Sortable.min.js" type="text/javascript"></script>
<script type="text/javascript">
    var level = <%{$menu_edit.level}%>;
    var item  = <%{:json_encode($menu_edit)}%>;
    var menu  = <%{:json_encode($list)}%>;
</script>